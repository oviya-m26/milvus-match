<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Internship Listings</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .internship-card {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .internship-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 10px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .skill-tag {
            transition: all 0.2s;
        }
        .skill-tag:hover {
            transform: scale(1.05);
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen p-4 md:p-8">
    <div class="container mx-auto max-w-7xl">
        <header class="text-center mb-12">
            <h1 class="text-4xl md:text-5xl font-bold text-gray-900 mb-4">Internship Opportunities</h1>
            <p class="text-lg text-gray-600">Find your next career opportunity</p>
        </header>
        
        <div id="internships" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
            <div class="text-center text-gray-500 py-12">
                <div class="animate-spin rounded-full h-12 w-12 border-t-2 border-b-2 border-blue-500 mx-auto mb-4"></div>
                <p>Loading internships...</p>
            </div>
        </div>
    </div>

    <script>
        // Format date to be more readable
        function formatDate(dateString) {
            if (!dateString) return 'N/A';
            const options = { year: 'numeric', month: 'long', day: 'numeric' };
            return new Date(dateString).toLocaleDateString('en-US', options);
        }

        // Fetch internships from the API
        async function fetchInternships() {
            const container = document.getElementById('internships');
            
            try {
                const response = await fetch('/api/internships');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const internships = await response.json();
                
                if (internships.length === 0) {
                    container.innerHTML = `
                        <div class="col-span-3 text-center py-12">
                            <div class="text-gray-400 mb-4">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M9.172 16.172a4 4 0 015.656 0M9 10h.01M15 10h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                                </svg>
                            </div>
                            <h3 class="text-xl font-semibold text-gray-700 mb-2">No internships found</h3>
                            <p class="text-gray-500">Check back later for new opportunities</p>
                        </div>`;
                    return;
                }
                
                container.innerHTML = ''; // Clear loading message
                
                internships.forEach(internship => {
                    const card = document.createElement('div');
                    card.className = 'bg-white rounded-xl shadow-md overflow-hidden internship-card border border-gray-100';
                    
                    // Parse skills if they're a string
                    let skills = [];
                    try {
                        skills = typeof internship.skills === 'string' ? 
                            JSON.parse(internship.skills) : 
                            (internship.skills || []);
                    } catch (e) {
                        console.error('Error parsing skills:', e);
                        skills = [];
                    }
                    
                    card.innerHTML = `
                        <div class="p-6">
                            <div class="flex justify-between items-start mb-2">
                                <div>
                                    <h2 class="text-xl font-bold text-gray-900">${internship.title || 'Untitled Position'}</h2>
                                    <p class="text-blue-600 font-semibold">${internship.company || 'Company not specified'}</p>
                                </div>
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-100 text-blue-800">
                                    ${internship.category || 'General'}
                                </span>
                            </div>
                            
                            <p class="text-gray-600 mb-4 text-sm">${internship.description || 'No description provided.'}</p>
                            
                            <div class="mb-4 flex flex-wrap gap-2">
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-blue-50 text-blue-700">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"></path>
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 11a3 3 0 11-6 0 3 3 0 016 0z"></path>
                                    </svg>
                                    ${internship.location || 'Remote'}
                                </span>
                                <span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-medium bg-green-50 text-green-700">
                                    <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                                    </svg>
                                    ${internship.duration || 'Flexible'}
                                </span>
                            </div>
                            
                            ${skills.length > 0 ? `
                            <div class="mb-4">
                                <h4 class="text-sm font-semibold text-gray-700 mb-2">Skills Required:</h4>
                                <div class="flex flex-wrap gap-1">
                                    ${skills.map(skill => 
                                        `<span class="skill-tag bg-gray-100 text-gray-700 text-xs px-2.5 py-1 rounded-full border border-gray-200">
                                            ${skill}
                                        </span>`
                                    ).join('')}
                                </div>
                            </div>` : ''}
                            
                            <div class="flex flex-col sm:flex-row justify-between items-start sm:items-center mt-6 pt-4 border-t border-gray-100">
                                <div class="mb-3 sm:mb-0">
                                    <div class="text-sm text-gray-500">Stipend</div>
                                    <div class="text-lg font-bold text-gray-900">â‚¹${internship.stipend || 'Negotiable'}</div>
                                </div>
                                <button class="w-full sm:w-auto bg-blue-600 hover:bg-blue-700 text-white px-5 py-2 rounded-lg text-sm font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-blue-500">
                                    Apply Now
                                </button>
                            </div>
                            
                            <div class="mt-4 pt-3 border-t border-gray-100 text-xs text-gray-500">
                                <div class="flex justify-between">
                                    <span>Posted: ${formatDate(internship.posted_date)}</span>
                                    ${internship.application_deadline ? 
                                        `<span>Apply by: ${formatDate(internship.application_deadline)}</span>` : 
                                        ''
                                    }
                                </div>
                            </div>
                        </div>
                    `;
                    container.appendChild(card);
                });
                
            } catch (error) {
                console.error('Error fetching internships:', error);
                container.innerHTML = `
                    <div class="col-span-3 text-center py-12">
                        <div class="text-red-500 mb-4">
                            <svg xmlns="http://www.w3.org/2000/svg" class="h-16 w-16 mx-auto" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="1.5" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                            </svg>
                        </div>
                        <h3 class="text-lg font-semibold text-gray-800 mb-2">Failed to load internships</h3>
                        <p class="text-gray-600 mb-4">${error.message || 'An error occurred while fetching data.'}</p>
                        <button onclick="fetchInternships()" class="text-blue-600 hover:text-blue-800 font-medium">
                            <span class="flex items-center justify-center">
                                <svg class="w-4 h-4 mr-1" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                                </svg>
                                Try Again
                            </span>
                        </button>
                        <p class="mt-4 text-xs text-gray-500">Make sure the backend server is running at http://127.0.0.1:5000</p>
                    </div>`;
            }
        }

        // Load internships when the page loads
        document.addEventListener('DOMContentLoaded', fetchInternships);
    </script>
</body>
</html>
